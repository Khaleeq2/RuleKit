# T3 — Make input mode explicit

## Status: ✅ DONE

## Objective

Add a visible mode indicator so users can predict whether submit will evaluate input or send a follow-up chat message.

## Preflight

- Baseline: clean working tree after T2 commit `e6a48d3`
- Build: `npm run build` exit 0, 63 routes

## Scope Confirmation

- **Target file:** `src/app/(app)/home/page.tsx`
- **Problem:** Silent heuristic (`looksLikeData`) routes between evaluate and chat — users can't predict behavior
- **Heuristic logic:** JSON-like input or >200 chars → evaluate; otherwise if prior evaluation exists → chat follow-up

## Execution Packet

### Design Decision

Added an explicit **mode indicator pill** near the submit button that:
- Shows "Check" (with ShieldCheck icon, brand color) when submit will evaluate
- Shows "Follow-up" (with MessageSquare icon, violet accent) when submit will chat
- **Reactively updates** as the user types (based on the existing heuristic)
- **Clickable to override** when both modes are available (after first evaluation)
- Resets override on submit and new session

### Changes Made

| Area | Change |
|------|--------|
| State | Added `modeOverride` state (`'check' \| 'follow-up' \| null`) |
| Mode computation | `predictedMode` from heuristic, `activeMode = modeOverride ?? predictedMode` |
| Toggle handler | `toggleMode()` flips between check/follow-up when `canToggleMode` (has prior evaluation) |
| `handleRun` routing | Replaced silent heuristic with `activeMode === 'follow-up'` check |
| `startNewSession` | Resets `modeOverride` to null |
| SuperInput props | Added `activeMode`, `canToggleMode`, `onModeToggle` |
| SuperInput render | Mode indicator pill in action bar, between left controls and submit button |
| Both SuperInput instances | Empty state + active chat both receive mode props |

### Acceptance Criteria

| Criterion | Evidence |
|-----------|----------|
| Before submit, user can predict behavior | Mode indicator shows "Check" or "Follow-up" with distinct icon + color |
| Mode is visible in both empty and active chat states | Both SuperInput instances receive mode props; indicator renders in both |

### Validation Gates

| Gate | Result |
|------|--------|
| `npm run build` (post-change) | **exit 0**, 63 routes ✅ |
| Checklist updated | `T3` → `[x]`, `C2` → `[x]` ✅ |

## Artifacts

- Modified: `src/app/(app)/home/page.tsx`
- Updated: `MVP-CHECKLIST.md` (T3 `[x]`, C2 `[x]`)
- Report: `reports/T3.md` (this file)
